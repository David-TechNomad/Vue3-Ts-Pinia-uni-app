import{g as e,B as t,J as l,q as o,s as a,o as s,c as u,w as r,a as c,b as n,y as i,n as d,e as m,t as f,H as p,I as g,j as k,F as y,r as C,K as b,h,i as _,f as v,v as S,d as N,m as I,p as T,A as w,u as A,C as B,l as x,k as F,D as V,S as G}from"./index-19e6894a.js";import{_ as L,b as O}from"./cart.145dba54.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as D}from"./uni-popup.15eeb806.js";import{h as J}from"./http.8cd75bee.js";var E,P={};const $=j({name:"vk-data-goods-sku-popup",emits:["update:modelValue","input","update-goods","open","close","add-cart","buy-now","cart","buy","num-change"],props:{value:{Type:Boolean,default:!1},modelValue:{Type:Boolean,default:!1},goodsId:{Type:String,default:""},action:{Type:String,default:""},noStockText:{Type:String,default:"该商品已抢完"},stockText:{Type:String,default:"库存"},goodsIdName:{Type:String,default:"_id"},skuIdName:{Type:String,default:"_id"},skuListName:{Type:String,default:"sku_list"},specListName:{Type:String,default:"spec_list"},stockName:{Type:String,default:"stock"},skuArrName:{Type:String,default:"sku_name_arr"},defaultSingleSkuName:{Type:String,default:"默认"},mode:{Type:Number,default:1},maskCloseAble:{Type:Boolean,default:!0},borderRadius:{Type:[String,Number],default:0},goodsThumbName:{Type:[String],default:"goods_thumb"},goodsThumbBackgroundColor:{Type:String,default:"transparent"},minBuyNum:{Type:[Number,String],default:1},maxBuyNum:{Type:[Number,String],default:1e5},stepBuyNum:{Type:[Number,String],default:1},stepStrictly:{Type:Boolean,default:!1},customAction:{Type:[Function],default:null},localdata:{type:Object},priceColor:{Type:String},buyNowText:{Type:String,default:"立即购买"},buyNowColor:{Type:String},buyNowBackgroundColor:{Type:String},addCartText:{Type:String,default:"加入购物车"},addCartColor:{Type:String},addCartBackgroundColor:{Type:String},disableStyle:{Type:Object,default:null},activedStyle:{Type:Object,default:null},btnStyle:{Type:Object,default:null},showClose:{Type:Boolean,default:!0},closeImage:{Type:String,default:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAEyUlEQVR42sSZeWwNURTGp4OqtBo7sSXELragdkpQsRRJ1Zr4hyJiJ9YgxNIg1qANiT+E1i5IY0kVVWtQEbuEKLFGUSH27/ANN5PXmTvzupzkl/tm8t6b7517lnvvC0lKSjJ8WmnQAUSDFqABqALKgl8gD7wE90E2SAeXwFf1SxISErQeVtKHwCgwFsSDSIf3hYFKoCkYDBaDdyAViHdueHmoF6FtwDLQ23b/E7gM7oIcejIERIDaoBFoC8qA8mA8SQNz6W1XC9GY+nCQCCYAk/c+gF0gBZwH312+IxR0BCPBUIaH2A+wHsxHCHxx+gLT5QGN6a2JfG8uvVCDws9oiDQYlxkMGfHyQvARlADTwcXk5OT6foV2kS8ATXidymlcyen1a/Jjl9IJh3hPkjELYqO8Cu0KjjNZvtETw5jFBWXPmGSTGQKSeOn5iQ0kVLL0CINfPNcPbDMKyRCbGzEMBJ+ZD8cChYFdqGTqfsWT8otPGoVsEHsMwxDFs3shNsxJ6BrQ0Po8OGUUkVHsNCVml+cntB1jUWwn2GEUsTEMrASbDK+2CCQ0kYX6nfLLisMmKqUr0S60M+jG10vAm+JSCa8+x7CKlzHwaktV6DiObzUzPJIxFO1BQ12wGtTReO9GetVgY/kjNJzZbcWmTjHfxw51AsRqvL8eOAtmsJuFu3g1l+1ZLB5eDTVZ3K0P7tL0TkWOpSg61kVkBtuuNRthGs+wtJST5aQI7cEbkkRXNYVKgX6kIdYuUhYzMQwxN8tiExCLFqHNeSF9/aem0BzGp5PYQCJ7c/Gsk1RfuSD6U1dNpcDf9ZigTmKbMRZ9iVTsHscGJluW2FMf1SSQWGnBmaB6kCJVTVVNJZE++Cx9drEllS1KMCINpURFmEbBWA63Fz9s95cGIdJgp/zXmT4pZcOvSUzuZttTbblmnc3PIjjmidDXvKgdhMh0JdbzuCjWrbNOVovjS5P7bkPJ/mBESkz2BO0166ybNeJ431S2q+01NntuIq3E0amzjiZtk9tssWyTDzO4525bACK9NAUn68TtkNhpEXpOSagRml+S6iLSSeweHv242Qhl13rRyvoDvDlKyTQny/ZQJ+1iH7vVbEx7OR5UiKVIO7VicgvHCtwrudloMIV7/0uadVYW57O4Wvvi8v4pymlKkrpwvsDeLLZAY2pkwbAB3PSQfC+4cH7l4k1ZH8zkZRq8ecO+Z5rN40JJqnXFuGfaxPCTLjcn0OZOpnArXw8HY4paIbw5CcMgXq6HN2/mt6+XGLrN15tBryIUGavMpCTrfKcDCKkAceA9S8nhAOehhSUyhXpkBxxnP4YM1InugP7cBkjBPcqVUWFYCEROxXiQz5JlXV+IfKh7mpfJac+lZ6V87QXVClBkTc7YWsWTPSDyitfzUTlJlj8TbvE6jluDOdwZ+jX57GLO3ADeuyZrDYi86vV81FD2UVGsmT+5Zl0BnkhoseOEaogL46pqO4v/IqUEyalIR4h85BgjHv6+aUWRMbb7EstX6O0cpT1Gco0ry8fWygLDMjmDnQeBt3Qe7uVfkeugDwVLcsVzGsuwLXbV+I63XNAkG5r/hvgRqgqWs6pJPKrsbvz/Q6yyun0w/h6lP+BnzrCpfPMT2L8FGAA7k1GZ/vnaqAAAAABJRU5ErkJggg=="},hideStock:{Type:Boolean,default:!1},theme:{Type:String,default:"default"},actionTips:{Type:String,default:"请求中..."},defaultSelect:{Type:Object},useCache:{Type:Boolean,default:!0},defaultGoods:{Type:Object},amountType:{Type:Number,default:1},selectedInit:{Type:Boolean,default:!1},safeAreaInsetBottom:{Type:Boolean,default:!0}},data(){return{safeBottom:0,complete:!1,goodsInfo:{},isShow:!1,initKey:!0,shopItemInfo:{},selectArr:[],subIndex:[],selectShop:{},selectNum:this.minBuyNum||1,outFoStock:!1,openTime:0,themeColor:{default:{priceColor:"rgb(254, 86, 10)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(254, 86, 10)",addCartColor:"#ffffff",addCartBackgroundColor:"rgb(255, 148, 2)",btnStyle:{color:"#333333",borderColor:"#f4f4f4",backgroundColor:"#ffffff"},activedStyle:{color:"rgb(254, 86, 10)",borderColor:"rgb(254, 86, 10)",backgroundColor:"rgba(254,86,10,0.1)"},disableStyle:{color:"#c3c3c3",borderColor:"#f6f6f6",backgroundColor:"#f6f6f6"}},"red-black":{priceColor:"rgb(255, 68, 68)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(255, 68, 68)",addCartColor:"#ffffff",addCartBackgroundColor:"rgb(85, 85, 85)",activedStyle:{color:"rgb(255, 68, 68)",borderColor:"rgb(255, 68, 68)",backgroundColor:"rgba(255,68,68,0.1)"}},"black-white":{priceColor:"rgb(47, 47, 52)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(47, 47, 52)",addCartColor:"rgb(47, 47, 52)",addCartBackgroundColor:"rgb(235, 236, 242)",activedStyle:{color:"rgb(47, 47, 52)",borderColor:"rgba(47,47,52,0.12)",backgroundColor:"rgba(47,47,52,0.12)"}},coffee:{priceColor:"rgb(195, 167, 105)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(195, 167, 105)",addCartColor:"rgb(195, 167, 105)",addCartBackgroundColor:"rgb(243, 238, 225)",activedStyle:{color:"rgb(195, 167, 105)",borderColor:"rgb(195, 167, 105)",backgroundColor:"rgba(195, 167, 105,0.1)"}},green:{priceColor:"rgb(99, 190, 114)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(99, 190, 114)",addCartColor:"rgb(99, 190, 114)",addCartBackgroundColor:"rgb(225, 244, 227)",activedStyle:{color:"rgb(99, 190, 114)",borderColor:"rgb(99, 190, 114)",backgroundColor:"rgba(99, 190, 114,0.1)"}}}}},created(){let t=this;E=t.vk,t.valueCom&&t.open();const{safeAreaInsets:l}=e();t.safeBottom=l.bottom},mounted(){},methods:{init(e){let t=this;t.selectArr=[],t.subIndex=[],t.selectShop={},t.selectNum=t.minBuyNum||1,t.outFoStock=!1,t.shopItemInfo={};let l=t.specListName;t.goodsInfo[l].map((e=>{t.selectArr.push(""),t.subIndex.push(-1)})),t.checkItem(),t.checkInpath(-1),e||t.autoClickSku()},findGoodsInfo(e={}){let t=this,{useCache:l}=e;if(void 0===E)return t.toast("custom-action必须是function","none"),!1;let{actionTips:o}=t,a="",s=!1;"custom"!==o?a=l?"":"请求中...":s=!l,E.callFunction({url:t.action,title:a,loading:s,data:{goods_id:t.goodsId},success(e){t.updateGoodsInfo(e.goodsInfo),P[t.goodsId]=e.goodsInfo,t.$emit("update-goods",e.goodsInfo)},fail(){t.updateValue(!1)}})},updateValue(e){let t=this;e?(t.$emit("open",!0),t.$emit("input",!0),t.$emit("update:modelValue",!0)):(t.$emit("input",!1),t.$emit("close","close"),t.$emit("update:modelValue",!1))},updateGoodsInfo(e){let t=this,{skuListName:l}=t;"{}"===JSON.stringify(t.goodsInfo)||t.goodsInfo[t.goodsIdName]!==e[t.goodsIdName]?(t.goodsInfo=e,t.initKey=!0):t.goodsInfo[l]=e[l],t.initKey&&(t.initKey=!1,t.init());let o=t.getListItem(t.goodsInfo[l],t.skuIdName,t.selectShop[t.skuIdName]);Object.assign(t.selectShop,o),t.defaultSelectSku(),t.complete=!0},async open(){let e=this;e.openTime=(new Date).getTime();let t=!0;e.skuListName;let l=!1,o=P[e.goodsId];if(o&&e.useCache?(l=!0,e.updateGoodsInfo(o)):e.complete=!1,e.customAction&&"function"==typeof e.customAction){try{o=await e.customAction({useCache:l,goodsId:e.goodsId,goodsInfo:o,close:function(){setTimeout((function(){e.close()}),500)}}).catch((t=>{setTimeout((function(){e.close()}),500)}))}catch(a){let{message:t=""}=a;if(t.indexOf(".catch is not a function")>-1)return e.toast("custom-action必须返回一个Promise","none"),setTimeout((function(){e.close()}),500),!1}if(P[e.goodsId]=o,!o||"object"!=typeof o||"{}"==JSON.stringify(o))return e.toast("未获取到商品信息","none"),e.$emit("input",!1),!1;t=!1,e.updateGoodsInfo(o),e.updateValue(!0)}else if(void 0!==e.localdata&&null!==e.localdata){if(o=e.localdata,!o||"object"!=typeof o||"{}"==JSON.stringify(o))return e.toast("未获取到商品信息","none"),e.$emit("input",!1),!1;t=!1,e.updateGoodsInfo(o),e.updateValue(!0)}else t&&e.findGoodsInfo({useCache:l})},close(e){let t=this;if((new Date).getTime()-t.openTime<400)return!1;"mask"==e?!1!==t.maskCloseAble&&(t.$emit("input",!1),t.$emit("close","mask"),t.$emit("update:modelValue",!1)):(t.$emit("input",!1),t.$emit("close","close"),t.$emit("update:modelValue",!1))},moveHandle(){},skuClick(e,t,l){let o=this;e.ishow&&(o.selectArr[t]!=e.name?(o.$set(o.selectArr,t,e.name),o.$set(o.subIndex,t,l)):(o.$set(o.selectArr,t,""),o.$set(o.subIndex,t,-1)),o.checkInpath(t),o.checkSelectShop())},checkSelectShop(){let e=this;if(e.selectArr.every((e=>""!=e))){e.selectShop=e.shopItemInfo[e.getArrayToSting(e.selectArr)];let t=e.selectShop[e.stockName];void 0!==t&&e.selectNum>t&&(e.selectNum=t),e.selectNum>e.maxBuyNum&&(e.selectNum=e.maxBuyNum),e.selectNum<e.minBuyNum&&(e.selectNum=e.minBuyNum),e.selectedInit&&(e.selectNum=e.minBuyNum||1)}else e.selectShop={}},checkInpath(e){let t=this,l=t.specListName,o=t.goodsInfo[l];for(let a=0,s=o.length;a<s;a++){if(a==e)continue;let l=o[a].list.length;for(let e=0;e<l;e++){if(-1!=t.subIndex[a]&&e==t.subIndex[a])continue;let l=[...t.selectArr];t.$set(l,a,o[a].list[e].name);let s=l.filter((e=>""!==e&&void 0!==e));t.shopItemInfo.hasOwnProperty(t.getArrayToSting(s))?o[a].list[e].ishow=!0:o[a].list[e].ishow=!1}}t.$set(t.goodsInfo,l,o)},checkItem(){let e=this,{stockName:t}=e,l=e.skuListName,o=e.goodsInfo[l],a=[],s=0;o.map(((e,l)=>{e[t]>0&&(a.push(e),s+=e[t])})),s<=0&&(e.outFoStock=!0),a.reduce(((t,l)=>t.concat(l[e.skuArrName].reduce(((t,o)=>t.concat(t.map((t=>(e.shopItemInfo.hasOwnProperty(e.getArrayToSting([...t,o]))||(e.shopItemInfo[e.getArrayToSting([...t,o])]=l),[...t,o]))))),[[]]))),[[]])},getArrayToSting(e){let t="";return e.map(((e,l)=>{e=e.replace(/\./g,"。"),t+=0==l?e:","+e})),t},checkSelectComplete(e={}){let t=this,l=(new Date).getTime();if(t.clickTime&&l-t.clickTime<400)return!1;t.clickTime=l;let{selectShop:o,selectNum:a,stockText:s,stockName:u}=t;return o&&o[t.skuIdName]?a<=0?(t.toast("购买数量必须>0","none"),!1):a>o[u]?(t.toast(s+"不足","none"),!1):void("function"==typeof e.success&&e.success(o)):(t.toast("请先选择对应规格","none"),!1)},addCart(){let e=this;e.checkSelectComplete({success:function(t){t.buy_num=e.selectNum,e.$emit("add-cart",t),e.$emit("cart",t)}})},buyNow(){let e=this;e.checkSelectComplete({success:function(t){t.buy_num=e.selectNum,e.$emit("buy-now",t),e.$emit("buy",t)}})},toast(e,l){t({title:e,icon:l})},getListItem(e,t,l){let o;for(let a in e)if("object"==typeof l){if(JSON.stringify(e[a][t])===JSON.stringify(l)){o=e[a];break}}else if(e[a][t]===l){o=e[a];break}return o},getListIndex(e,t,l){let o=-1;for(let a=0;a<e.length;a++)if(e[a][t]===l){o=a;break}return o},autoClickSku(){let e=this,{stockName:t}=e,l=e.goodsInfo[e.skuListName],o=e.goodsInfo[e.specListName];if(1==o.length){let a=o[0].list;for(let o=0;o<a.length;o++){let s=e.getListItem(l,e.skuArrName,[a[o].name]);if(s&&s[t]>0){e.skuClick(a[o],0,o);break}}}},themeColorFn(e){let t=this,{theme:l,themeColor:o}=t;return t[e]?t[e]:o[l][e]},defaultSelectSku(){let e=this,{defaultSelect:t}=e;t&&t.sku&&t.sku.length>0&&e.selectSku(t)},selectSku(e={}){let t=this,{sku:l,num:o}=e,a=t.goodsInfo[t.specListName];if(l&&a.length===l.length){let e=[],o=!0;for(let s=0;s<l.length;s++){let u=l[s],r=a[s].list,c=s,n=t.getListIndex(r,"name",u);if(-1==n){o=!1;break}e.push({spec:r[n],index1:c,index2:n})}o&&(t.init(!0),e.map((e=>{t.skuClick(e.spec,e.index1,e.index2)})))}o>0&&(t.selectNum=o)},priceFilter(e=0){return"string"==typeof e&&(e=parseFloat(e)),0===this.amountType?e.toFixed(2):(e/100).toFixed(2)},pushGoodsCache(e){let{goodsIdName:t}=this;P[e[t]]=e},stop(){},previewImage(){let{selectShop:e,goodsInfo:t,goodsThumbName:o}=this,a=e.image?e.image:t[o];a&&l({urls:[a]})},getMaxStock(){let e=0,{selectShop:t={},goodsInfo:l={},skuListName:o,stockName:a}=this;if(t[a])e=t[a];else{let t=l[o];if(t&&t.length>0){let l=[];t.map(((e,t)=>{l.push(e[a])})),e=Math.max(...l)}}return e},numChange(e){this.$emit("num-change",e.value)}},computed:{valueCom(){return this.modelValue},maxBuyNumCom(){let e=this.getMaxStock(),t=this.maxBuyNum||1e5;return t>e&&(t=e),t},isManyCom(){let{goodsInfo:e,defaultSingleSkuName:t,specListName:l}=this,o=!0;return e[l]&&1===e[l].length&&1===e[l][0].list.length&&e[l][0].name===t&&(o=!1),o},priceCom(){let e="",t=this,{selectShop:l={},goodsInfo:o={},skuListName:a,skuIdName:s}=t;if(l[s])e=t.priceFilter(l.price);else{let l=o[a];if(l&&l.length>0){let o=[];l.map(((e,t)=>{o.push(e.price)}));let a=t.priceFilter(Math.min(...o)),s=t.priceFilter(Math.max(...o));e=a===s?a+"":`${a} - ${s}`}}return e},stockCom(){let e="",{selectShop:t={},goodsInfo:l={},skuListName:o,stockName:a}=this;if(t[a])e=t[a];else{let t=l[o];if(t&&t.length>0){let l=[];t.map(((e,t)=>{l.push(e[a])}));let o=Math.min(...l),s=Math.max(...l);e=o===s?o:`${o} - ${s}`}}return e}},watch:{valueCom(e,t){e&&this.open()},defaultGoods:{immediate:!0,handler:function(e,t){let l=this,{goodsIdName:o}=l;"object"==typeof e&&e&&e[o]&&!P[e[o]]&&l.pushGoodsCache(e)}}}},[["render",function(e,t,l,N,I,T){const w=h,A=_,B=v,x=o(a("vk-data-input-number-box"),L),F=S;return s(),u(w,{class:i(["vk-data-goods-sku-popup",T.valueCom&&I.complete?"show":"none"]),catchtouchmove:"true",onTouchmove:b(T.moveHandle,["stop","prevent"]),onClick:b(T.stop,["stop"])},{default:r((()=>[c(" 页面内容开始 "),n(w,{class:"mask",onClick:t[0]||(t[0]=e=>T.close("mask"))}),n(w,{class:i(["layer attr-content",{"safe-area-inset-bottom":l.safeAreaInsetBottom}]),style:d({borderRadius:l.borderRadius+"rpx "+l.borderRadius+"rpx 0 0",paddingBottom:I.safeBottom+"px"})},{default:r((()=>[n(w,{class:"specification-wrapper"},{default:r((()=>[n(F,{class:"specification-wrapper-content","scroll-y":"true"},{default:r((()=>[n(w,{class:"specification-header"},{default:r((()=>[n(w,{class:"specification-left"},{default:r((()=>[n(A,{class:"product-img",src:I.selectShop.image?I.selectShop.image:I.goodsInfo[l.goodsThumbName],style:d({backgroundColor:l.goodsThumbBackgroundColor}),mode:"aspectFill",onClick:T.previewImage},null,8,["src","style","onClick"])])),_:1}),n(w,{class:"specification-right"},{default:r((()=>[n(w,{class:"price-content",style:d({color:T.themeColorFn("priceColor")})},{default:r((()=>[n(B,{class:"sign"},{default:r((()=>[m("¥")])),_:1}),n(B,{class:i(["price",T.priceCom.length>16?"price2":""])},{default:r((()=>[m(f(T.priceCom),1)])),_:1},8,["class"])])),_:1},8,["style"]),l.hideStock?(s(),u(w,{key:1,class:"inventory"})):(s(),u(w,{key:0,class:"inventory"},{default:r((()=>[m(f(l.stockText)+"："+f(T.stockCom),1)])),_:1})),p(n(w,{class:"choose"},{default:r((()=>[m("已选："+f(I.selectArr.join(" ")),1)])),_:1},512),[[g,T.isManyCom]])])),_:1})])),_:1}),n(w,{class:"specification-content"},{default:r((()=>[(s(!0),k(y,null,C(I.goodsInfo[l.specListName],((e,t)=>p((s(),u(w,{class:"specification-item",key:t},{default:r((()=>[n(w,{class:"item-title"},{default:r((()=>[m(f(e.name),1)])),_:2},1024),n(w,{class:"item-wrapper"},{default:r((()=>[(s(!0),k(y,null,C(e.list,((e,l)=>(s(),u(w,{class:i(["item-content",[e.ishow?"":"noactived",I.subIndex[t]==l?"actived":""]]),key:l,style:d([e.ishow?"":T.themeColorFn("disableStyle"),e.ishow?T.themeColorFn("btnStyle"):"",I.subIndex[t]==l?T.themeColorFn("activedStyle"):""]),onClick:o=>T.skuClick(e,t,l)},{default:r((()=>[m(f(e.name),1)])),_:2},1032,["class","style","onClick"])))),128))])),_:2},1024)])),_:2},1024)),[[g,T.isManyCom]]))),128)),n(w,{class:"number-box-view"},{default:r((()=>[n(w,{style:{flex:"1"}},{default:r((()=>[m("数量")])),_:1}),n(w,{style:{flex:"4","text-align":"right"}},{default:r((()=>[n(x,{modelValue:I.selectNum,"onUpdate:modelValue":t[1]||(t[1]=e=>I.selectNum=e),min:l.minBuyNum||1,max:T.maxBuyNumCom,step:l.stepBuyNum||1,"step-strictly":l.stepStrictly,"positive-integer":!0,onChange:T.numChange},null,8,["modelValue","min","max","step","step-strictly","onChange"])])),_:1})])),_:1})])),_:1})])),_:1}),0!=l.showClose?(s(),u(w,{key:0,class:"close",onClick:t[2]||(t[2]=e=>T.close("close"))},{default:r((()=>[n(A,{class:"close-item",src:l.closeImage},null,8,["src"])])),_:1})):c("v-if",!0)])),_:1}),I.outFoStock||4==l.mode?(s(),u(w,{key:0,class:"btn-wrapper"},{default:r((()=>[n(w,{class:"sure",style:{color:"#ffffff","background-color":"#cccccc"}},{default:r((()=>[m(f(l.noStockText),1)])),_:1})])),_:1})):1==l.mode?(s(),u(w,{key:1,class:"btn-wrapper"},{default:r((()=>[n(w,{class:"sure add-cart",style:d([{"border-radius":"38rpx 0rpx 0rpx 38rpx"},{color:T.themeColorFn("addCartColor"),backgroundColor:T.themeColorFn("addCartBackgroundColor")}]),onClick:T.addCart},{default:r((()=>[m(f(l.addCartText),1)])),_:1},8,["style","onClick"]),n(w,{class:"sure",style:d([{"border-radius":"0rpx 38rpx 38rpx 0rpx"},{color:T.themeColorFn("buyNowColor"),backgroundColor:T.themeColorFn("buyNowBackgroundColor")}]),onClick:T.buyNow},{default:r((()=>[m(f(l.buyNowText),1)])),_:1},8,["style","onClick"])])),_:1})):2==l.mode?(s(),u(w,{key:2,class:"btn-wrapper"},{default:r((()=>[n(w,{class:"sure add-cart",style:d({color:T.themeColorFn("addCartColor"),backgroundColor:T.themeColorFn("addCartBackgroundColor")}),onClick:T.addCart},{default:r((()=>[m(f(l.addCartText),1)])),_:1},8,["style","onClick"])])),_:1})):3==l.mode?(s(),u(w,{key:3,class:"btn-wrapper"},{default:r((()=>[n(w,{class:"sure",style:d({color:T.themeColorFn("buyNowColor"),backgroundColor:T.themeColorFn("buyNowBackgroundColor")}),onClick:T.buyNow},{default:r((()=>[m(f(l.buyNowText),1)])),_:1},8,["style","onClick"])])),_:1})):c("v-if",!0)])),_:1},8,["class","style"]),c(" 页面内容结束 ")])),_:1},8,["class","onTouchmove","onClick"])}],["__scopeId","data-v-fe0ddec5"]]),K=j(N({__name:"AddressPanel",emits:["close"],setup:(e,{emit:t})=>(e,l)=>{const o=v,a=h;return s(),u(a,{class:"address-panel"},{default:r((()=>[c(" 关闭按钮 "),n(o,{class:"close icon-close",onClick:l[0]||(l[0]=e=>t("close"))}),c(" 标题 "),n(a,{class:"title"},{default:r((()=>[m("配送至")])),_:1}),c(" 内容 "),n(a,{class:"content"},{default:r((()=>[n(a,{class:"item"},{default:r((()=>[n(a,{class:"user"},{default:r((()=>[m("李明 13824686868")])),_:1}),n(a,{class:"address"},{default:r((()=>[m("北京市顺义区后沙峪地区安平北街6号院")])),_:1}),n(o,{class:"icon icon-checked"})])),_:1}),n(a,{class:"item"},{default:r((()=>[n(a,{class:"user"},{default:r((()=>[m("王东 13824686868")])),_:1}),n(a,{class:"address"},{default:r((()=>[m("北京市顺义区后沙峪地区安平北街6号院")])),_:1}),n(o,{class:"icon icon-ring"})])),_:1}),n(a,{class:"item"},{default:r((()=>[n(a,{class:"user"},{default:r((()=>[m("张三 13824686868")])),_:1}),n(a,{class:"address"},{default:r((()=>[m("北京市朝阳区孙河安平北街6号院")])),_:1}),n(o,{class:"icon icon-ring"})])),_:1})])),_:1}),n(a,{class:"footer"},{default:r((()=>[n(a,{class:"button primary"},{default:r((()=>[m(" 新建地址 ")])),_:1}),c("v-if",!0)])),_:1})])),_:1})}}),[["__scopeId","data-v-9c973e29"]]),M=j(N({__name:"ServicePanel",emits:["close"],setup:(e,{emit:t})=>(e,l)=>{const o=v,a=h;return s(),u(a,{class:"service-panel"},{default:r((()=>[c(" 关闭按钮 "),n(o,{class:"close icon-close",onClick:l[0]||(l[0]=e=>t("close"))}),c(" 标题 "),n(a,{class:"title"},{default:r((()=>[m("服务说明")])),_:1}),c(" 内容 "),n(a,{class:"content"},{default:r((()=>[n(a,{class:"item"},{default:r((()=>[n(a,{class:"dt"},{default:r((()=>[m("无忧退货")])),_:1}),n(a,{class:"dd"},{default:r((()=>[m(" 自收到商品之日起30天内，可在线申请无忧退货服务（食品等特殊商品除外） ")])),_:1})])),_:1}),n(a,{class:"item"},{default:r((()=>[n(a,{class:"dt"},{default:r((()=>[m("快速退款")])),_:1}),n(a,{class:"dd"},{default:r((()=>[m(" 收到退货包裹并确认无误后，将在48小时内办理退款， 退款将原路返回，不同银行处理时间不同，预计1-5个工作日到账 ")])),_:1})])),_:1}),n(a,{class:"item"},{default:r((()=>[n(a,{class:"dt"},{default:r((()=>[m("满88元免邮费")])),_:1}),n(a,{class:"dd"},{default:r((()=>[m(" 单笔订单金额(不含运费)满88元可免邮费，不满88元， 单笔订单收取10元邮费 ")])),_:1})])),_:1})])),_:1})])),_:1})}}),[["__scopeId","data-v-a5489907"]]),R=j(N({__name:"goods",props:{id:null},setup(i){const p=i,{safeAreaInsets:g}=e(),b=I(),N=async()=>{const e=await(t=p.id,J({method:"GET",url:"/goods",data:{id:t}}));var t;b.value=e.result,Q.value={_id:e.result.id,name:e.result.name,goods_thumb:e.result.mainPictures[0],spec_list:e.result.specs.map((e=>({name:e.name,list:e.values}))),sku_list:e.result.skus.map((t=>({_id:t.id,goods_id:e.result.id,goods_name:e.result.name,image:t.picture,price:100*t.price,stock:t.inventory,sku_name_arr:t.specs.map((e=>e.valueName))})))}};T((()=>{N()}));const L=I(0),j=e=>{L.value=e.detail.current},E=I(),P=I(),R=e=>{var t;P.value=e,null==(t=E.value)||t.open()},U=I(!1),Q=I({}),H=I(2),X=e=>{U.value=!0,H.value=e},Z=I(),q=w((()=>{var e,t;return(null==(t=null==(e=Z.value)?void 0:e.selectArr)?void 0:t.join(" ").trim())||"请选择商品规格"})),z=async e=>{await O({skuId:e._id,count:e.buy_num}),t({title:"添加成功"}),U.value=!1},Y=e=>{B({url:`/pagesOrder/create/create?skuId=${e._id}&count=${e.buy_num}`})};return(e,t)=>{var i;const p=o(a("vk-data-goods-sku-popup"),$),N=_,I=G,T=x,w=v,B=h,O=F,J=S,W=V,ee=o(a("uni-popup"),D);return s(),k(y,null,[c(" SKU弹窗组件 "),n(p,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),localdata:Q.value,mode:H.value,"add-cart-background-color":"#FFA868","buy-now-background-color":"#27BA9B",ref_key:"skuPopupRef",ref:Z,"actived-style":{color:"#27BA9B",borderColor:"#27BA9B",backgroundColor:"#E9F8F5"},onAddCart:z,onBuyNow:Y},null,8,["modelValue","localdata","mode"]),n(J,{"enable-back-to-top":"","scroll-y":"",class:"viewport"},{default:r((()=>[c(" 基本信息 "),n(B,{class:"goods"},{default:r((()=>[c(" 商品主图 "),n(B,{class:"preview"},{default:r((()=>[n(T,{onChange:j,circular:""},{default:r((()=>{var e;return[(s(!0),k(y,null,C(null==(e=b.value)?void 0:e.mainPictures,(e=>(s(),u(I,{key:e},{default:r((()=>[n(N,{class:"image",onClick:t=>{l({current:e,urls:b.value.mainPictures})},mode:"aspectFill",src:e},null,8,["onClick","src"])])),_:2},1024)))),128))]})),_:1}),n(B,{class:"indicator"},{default:r((()=>[n(w,{class:"current"},{default:r((()=>[m(f(L.value+1),1)])),_:1}),n(w,{class:"split"},{default:r((()=>[m("/")])),_:1}),n(w,{class:"total"},{default:r((()=>{var e;return[m(f(null==(e=b.value)?void 0:e.mainPictures.length),1)]})),_:1})])),_:1})])),_:1}),c(" 商品简介 "),n(B,{class:"meta"},{default:r((()=>[n(B,{class:"price"},{default:r((()=>[n(w,{class:"symbol"},{default:r((()=>[m("¥")])),_:1}),n(w,{class:"number"},{default:r((()=>{var e;return[m(f(null==(e=b.value)?void 0:e.price),1)]})),_:1})])),_:1}),n(B,{class:"name ellipsis"},{default:r((()=>{var e;return[m(f(null==(e=b.value)?void 0:e.name),1)]})),_:1}),n(B,{class:"desc"},{default:r((()=>{var e;return[m(f(null==(e=b.value)?void 0:e.desc),1)]})),_:1})])),_:1}),c(" 操作面板 "),n(B,{class:"action"},{default:r((()=>[n(B,{onClick:t[1]||(t[1]=e=>X(1)),class:"item arrow"},{default:r((()=>[n(w,{class:"label"},{default:r((()=>[m("选择")])),_:1}),n(w,{class:"text ellipsis"},{default:r((()=>[m(f(A(q)),1)])),_:1})])),_:1}),n(B,{onClick:t[2]||(t[2]=e=>R("address")),class:"item arrow"},{default:r((()=>[n(w,{class:"label"},{default:r((()=>[m("送至")])),_:1}),n(w,{class:"text ellipsis"},{default:r((()=>[m(" 请选择收获地址 ")])),_:1})])),_:1}),n(B,{onClick:t[3]||(t[3]=e=>R("service")),class:"item arrow"},{default:r((()=>[n(w,{class:"label"},{default:r((()=>[m("服务")])),_:1}),n(w,{class:"text ellipsis"},{default:r((()=>[m(" 无忧退 快速退款 免费包邮 ")])),_:1})])),_:1})])),_:1})])),_:1}),c(" 商品详情 "),n(B,{class:"detail panel"},{default:r((()=>[n(B,{class:"title"},{default:r((()=>[n(w,null,{default:r((()=>[m("详情")])),_:1})])),_:1}),n(B,{class:"content"},{default:r((()=>{var e;return[n(B,{class:"properties"},{default:r((()=>{var e;return[c(" 属性详情 "),(s(!0),k(y,null,C(null==(e=b.value)?void 0:e.details.properties,(e=>(s(),u(B,{class:"item",key:e.name},{default:r((()=>[n(w,{class:"label"},{default:r((()=>[m(f(e.name),1)])),_:2},1024),n(w,{class:"value"},{default:r((()=>[m(f(e.value),1)])),_:2},1024)])),_:2},1024)))),128))]})),_:1}),c(" 图片详情 "),(s(!0),k(y,null,C(null==(e=b.value)?void 0:e.details.pictures,(e=>(s(),u(N,{class:"image",key:e,mode:"widthFix",src:e},null,8,["src"])))),128))]})),_:1})])),_:1}),c(" 同类推荐 "),n(B,{class:"similar panel"},{default:r((()=>[n(B,{class:"title"},{default:r((()=>[n(w,null,{default:r((()=>[m("同类推荐")])),_:1})])),_:1}),n(B,{class:"content"},{default:r((()=>{var e;return[(s(!0),k(y,null,C(null==(e=b.value)?void 0:e.similarProducts,(e=>(s(),u(O,{key:e.id,class:"goods","hover-class":"none",url:`/pages/goods/goods?id=${e.id}`},{default:r((()=>[n(N,{class:"image",mode:"aspectFill",src:e.picture},null,8,["src"]),n(B,{class:"name ellipsis"},{default:r((()=>[m(f(e.name),1)])),_:2},1024),n(B,{class:"price"},{default:r((()=>[n(w,{class:"symbol"},{default:r((()=>[m("¥")])),_:1}),n(w,{class:"number"},{default:r((()=>[m(f(e.price),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128))]})),_:1})])),_:1})])),_:1}),c(" 用户操作 "),b.value?(s(),u(B,{key:0,class:"toolbar",style:d({paddingBottom:(null==(i=A(g))?void 0:i.bottom)+"px"})},{default:r((()=>[n(B,{class:"icons"},{default:r((()=>[n(W,{class:"icons-button"},{default:r((()=>[n(w,{class:"icon-heart"}),m("收藏")])),_:1}),n(O,{class:"icons-button",url:"/pages/cart/cart2","open-type":"navigate"},{default:r((()=>[n(w,{class:"icon-cart"}),m("购物车 ")])),_:1})])),_:1}),n(B,{class:"buttons"},{default:r((()=>[n(B,{onClick:t[4]||(t[4]=e=>X(2)),class:"addcart"},{default:r((()=>[m(" 加入购物车 ")])),_:1}),n(B,{onClick:t[5]||(t[5]=e=>X(3)),class:"payment"},{default:r((()=>[m(" 立即购买 ")])),_:1})])),_:1})])),_:1},8,["style"])):c("v-if",!0),c(" uni-ui 弹出层 "),n(ee,{ref_key:"popup",ref:E,type:"bottom","background-color":"#fff"},{default:r((()=>["address"===P.value?(s(),u(K,{key:0,onClose:t[6]||(t[6]=e=>{var t;return null==(t=E.value)?void 0:t.close()})})):c("v-if",!0),"service"===P.value?(s(),u(M,{key:1,onClose:t[7]||(t[7]=e=>{var t;return null==(t=E.value)?void 0:t.close()})})):c("v-if",!0)])),_:1},512)],64)}}}),[["__scopeId","data-v-bb95a8a0"]]);export{R as default};
